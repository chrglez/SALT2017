{
    "collab_server" : "",
    "contents" : "library(ggmap)\nlibrary(geosphere)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(readr)\nlibrary(RColorBrewer)\nlibrary(grid)\nlibrary(gridExtra)\n\nlonlat_hoteles <- readRDS(\"lonlat_network_hoteles.Rds\")\nnames(lonlat_hoteles)[3]<-\"lugar\"\nlonlat_actividades <- readRDS(\"lonlat_network_actividades.Rds\")\nnames(lonlat_actividades)[3]<-\"lugar\"\nlonlat_actividades[lonlat_actividades$lugar == \"Palmitos_Park\",c(\"lon\",\"lat\")] <- c(27.778,-15.61) #c(27.78,-15.575)\nlonlat_restaurantes <- readRDS(\"lonlat_network_restaurantes.Rds\")\nnames(lonlat_restaurantes)[3]<-\"lugar\"\n\nlonlat_db <- bind_rows(lonlat_hoteles,lonlat_actividades,lonlat_restaurantes, .id=\"tipo\" )\nlonlat_db$tipo <- factor(lonlat_db$tipo,labels = c(\"hoteles\",\"actividades\",\"restaurantes\"), levels = 1:3)\n#lonlat_db$lugar <- factor(lonlat_db$lugar)\nmyMap<-get_map(location=\"Maspalomas\",source=\"google\",maptype=\"roadmap\", crop=FALSE, zoom = 12, color =\"bw\")\n\ndb_vertices <- inner_join(lonlat_db,inst_com_filtrada, by=\"lugar\") %>%\n      mutate(lon_vertice = lat,\n             lat_vertice = lon,\n             tipo = tipo.y) %>%\n      select(lon_vertice, lat_vertice, lugar, tipo, num_count)\n\ndb_enlaces <- inner_join(db_filtrada, lonlat_db, by = c(\"hotel\" = \"lugar\")) %>%\n      mutate(lon_origen = lat,\n             lat_origen = lon) %>%\n      select(lon_origen,lat_origen,hotel, lugar, nop_act) %>%\n      inner_join(lonlat_db) %>%\n      mutate(lon_destino = lat,\n             lat_destino = lon) %>%\n      select(lon_origen, lat_origen, lon_destino, lat_destino, hotel, lugar, nop_act)\n\n# Mapa completo\n\n\ngg <- ggmap(myMap) +\n      geom_point(data = db_vertices,\n                 aes(x = lon_vertice, y = lat_vertice, color = tipo, size = num_count), alpha = 0.4) +\n      geom_curve(data = db_enlaces,\n                 aes(x = lon_origen, y = lat_origen, xend = lon_destino, yend = lat_destino, size = nop_act),\n                 alpha = 0.1, curvature = 0.15, inherit.aes = TRUE) +\n      scale_color_discrete(name = \"\") +\n      scale_size_continuous(name = \"# comments\") +\n      coord_cartesian(xlim = c(-15.69,-15.53),\n                      ylim = c(27.73,27.835)) +\n      labs(x = \"\", y = \"\") +\n      theme(\n            #axis.text = element_blank(),\n            #axis.ticks = element_blank(),\n            legend.position = \"bottom\",\n            legend.key = element_rect(colour = \"transparent\", fill = \"white\") \n      )\n\n#EPS\ncairo_ps(\"Rawmap.eps\")\ngg\ndev.off()\n\n#Solo puntos sin tamaÃ±o, conexiones sin grosor\n\ngg2 <- ggmap(myMap) +\n      geom_point(data = db_vertices,\n                 aes(x = lon_vertice, y = lat_vertice, color = tipo)) +\n      geom_curve(data = db_enlaces,\n                 aes(x = lon_origen, y = lat_origen, xend = lon_destino, yend = lat_destino),\n                 curvature = 0.15, inherit.aes = TRUE, alpha = 0.1) +\n      scale_color_discrete(name = \"\") +\n      scale_size_continuous(name = \"# comments\") +\n      coord_cartesian(xlim = c(-15.69,-15.53),\n                      ylim = c(27.73,27.835)) +\n      labs(x = \"\", y = \"\") +\n      theme(\n            axis.text = element_blank(),\n            axis.ticks = element_blank(),\n            legend.position = \"bottom\",\n            legend.key = element_rect(colour = \"transparent\", fill = \"white\") \n      )\n\n\n#EPS\ncairo_ps(\"rawmap2.eps\")\ngg2\ndev.off()\n\n# Mapa recortado\ntemp = db_vertices %>%\n      filter(lugar == \"Playa_de_Maspalomas\" | lugar == \"Dunas_de_Maspalomas\" ) %>%\n      select(num_count) %>% sum()\n\ntemp2 = db_vertices %>%\n      filter(lugar == \"Aqualand\" | lugar == \"Aqualand_Maspalomas\" ) %>%\n      select(num_count) %>% sum()\n\n\ndb_vertices2 <- db_vertices %>% mutate(num_count = replace(num_count, lugar == \"Playa_de_Maspalomas\", temp),\n                                       num_count = replace(num_count, lugar == \"Aqualand\", temp2)) %>%\n      filter(!(lugar == \"Dunas_de_Maspalomas\" | lugar == \"Aqualand_Maspalomas\"))\n\ndb_vertices2 <- db_vertices2[-90,] #Mana_264 se repite 2 veces\n\ndb_vertices2$tipo2 <- factor(c(\"Lodgings\",\"Services\",\"Services\")[match(db_vertices2$tipo, c(\"Hotel\",\"Actividad\",\"Restaurante\"))])\n\n\ndb_filtrada2 <- db_filtrada %>%\n      mutate(lugar = replace(lugar, lugar == \"Dunas_de_Maspalomas\", \"Playa_de_Maspalomas\"),\n             lugar = replace(lugar, lugar == \"Aqualand_Maspalomas\", \"Aqualand\")) %>%\n      group_by(hotel,lugar) %>%\n      summarise(nop_act2 = sum(nop_act))\n\n\ndb_enlaces2 <- inner_join(db_filtrada2, lonlat_db, by = c(\"hotel\" = \"lugar\")) %>%\n      mutate(lon_origen = lat,\n             lat_origen = lon) %>%\n      select(lon_origen,lat_origen,hotel, lugar, nop_act2) %>%\n      inner_join(lonlat_db) %>%\n      mutate(lon_destino = lat,\n             lat_destino = lon) %>%\n      select(lon_origen, lat_origen, lon_destino, lat_destino, hotel, lugar, nop_act2)\n\n\ndb_vertices2 <- db_vertices2 %>%\n      filter(lon_vertice >= -15.62 & lon_vertice <= -15.53 & lat_vertice >= 27.73 & lat_vertice <= 27.78)\n\ndb_enlaces2 <- db_enlaces2 %>%\n      filter(lon_origen >= -15.62 & lon_origen <= -15.53 & lat_origen >= 27.73 & lat_origen <= 27.78 &\n                   lon_destino >= -15.62 & lon_destino <= -15.53 & lat_destino >= 27.73 & lat_destino <= 27.78)\n      \n             \n\nmyMap2<-get_map(location=\"Maspalomas\",source=\"google\",maptype=\"satellite\", crop=FALSE, zoom = 12,color=\"bw\")\n\n\ngg3 <- ggmap(myMap2) +\n      geom_curve(data = db_enlaces2,\n                 aes(x = lon_origen, y = lat_origen, xend = lon_destino, yend = lat_destino),\n                 alpha = 0.6, curvature = 0.15, inherit.aes = TRUE, size = 0.5, color = \"black\") +\n      geom_point(data = db_vertices2,\n                 aes(x = lon_vertice, y = lat_vertice, shape = tipo2, color = tipo2, size = num_count), alpha = 0.6) +\n      scale_color_manual(name = \"\", values = c(\"chocolate1\",\"chartreuse2\")) +\n      scale_size(name=\"\", guide = \"none\")+\n      scale_shape_discrete(name = \"\") +\n      coord_cartesian(xlim = c(-15.62,-15.53),\n                      ylim = c(27.73,27.78)) +\n      labs(x = \"\", y = \"\") +\n      theme(\n            axis.text = element_blank(),\n            axis.ticks = element_blank(),\n            legend.position = \"bottom\",\n            legend.key = element_rect(colour = \"transparent\", fill = \"white\"),\n            panel.background = element_rect(fill=\"white\"),\n            panel.grid = element_blank(),\n            legend.text = element_text(size = 11))+\n      guides(color = guide_legend(override.aes = list(size=3)))\n\n# eps con transparencias\n#cairo_ps(\"rawmap_white.eps\")\n#gg3\n#dev.off()\n\n\nsetwd(\"E:/User/Dropbox/Dropbox/Christian-Juan/Distancias\")\n\n\n\nsim_data_01 <- \"Deg_s_sim_dist_-0.1.csv\" %>%\n      read_csv() %>%\n      group_by(x) %>%\n      summarise(num = n()) %>%\n      transmute(x = x,\n                value = num/sum(num),\n                value_dist = 1 - c(0,cumsum(value)[1:nrow(.) - 1]),\n                proc = rep(\"alpha = 0.1\",nrow(.)))\n\nsim_data_05 <- \"Deg_s_sim_dist_-0.5.csv\" %>%\n      read_csv() %>%\n      group_by(x) %>%\n      summarise(num = n()) %>%\n      transmute(x = x,\n                value = num/sum(num),\n                value_dist = 1 - c(0,cumsum(value)[1:nrow(.) - 1]),\n                proc = rep(\"alpha = 0.5\",nrow(.)))\n\nsim_data_1 <- \"Deg_s_sim_dist_-1.csv\" %>%\n      read_csv() %>%\n      group_by(x) %>%\n      summarise(num = n()) %>%\n      transmute(x = x,\n                value = num/sum(num),\n                value_dist = 1 - c(0,cumsum(value)[1:nrow(.) - 1]),\n                proc = rep(\"alpha = 1\",nrow(.)))\n\nmasp <- \"Deg_s_masp.csv\" %>%\n      read_csv() %>%\n      group_by(x) %>%\n      summarise(num = n()) %>%\n      transmute(x = x,\n                value = num/sum(num),\n                value_dist = 1 - c(0,cumsum(value)[1:nrow(.) - 1]),\n                proc = rep(\"real\",nrow(.)))\n\npowerlaw <- rbind(sim_data_01,sim_data_05,sim_data_1, masp)\n\n\n\nmy.labs <- list(bquote(alpha==.(0.1)),bquote(alpha==.(0.5)),bquote(alpha==.(1)),\"real\")\n\ngg <-      ggplot() +\n      geom_point(data = powerlaw,\n                 aes(x = x, y = value_dist, color = proc, shape = proc, size = proc)) +\n      scale_shape_manual(name = \"\", values = c(\"alpha = 0.1\" = 1,\"alpha = 0.5\" = 1, \"alpha = 1\" = 1, 'real' = 16),\n                         labels = my.labs) +\n      scale_colour_brewer(name = \"\", palette = \"Set1\",labels = my.labs) +\n      scale_size_manual(name = \"\", values = c(\"alpha = 0.1\" = 3,\"alpha = 0.5\" = 3, \"alpha = 1\" = 3, 'real' = 1),\n                        labels = my.labs) +\n      scale_x_log10(\n            #breaks = scales::trans_breaks(\"log10\", function(x) 10^x),\n            labels = scales::trans_format(\"log10\", scales::math_format(10^.x))) +\n      scale_y_log10(\n            #breaks = scales::trans_breaks(\"log10\", function(x) 10^x),\n            labels = scales::trans_format(\"log10\", scales::math_format(10^.x))) +\n      theme_bw() +\n      theme(panel.grid.major.x = element_blank(),\n            panel.grid.minor.x = element_blank(),\n            panel.grid.major.y = element_blank(),\n            panel.grid.minor.y = element_blank(),\n            legend.key = element_rect(colour = \"transparent\"),\n            legend.key.size = unit(0.6, \"cm\"),\n            legend.text = element_text(size = 11),\n            legend.title = element_blank(),\n            axis.text = element_text(size = 11),\n            axis.title = element_text(size = 13),\n            strip.text = element_text(size=11),\n            legend.position = \"bottom\"\n      ) +\n      labs(x = 's', y = 'P(s)') +\n      annotation_logticks() \n\n\n\n\n\n# gg <- plot de P(s) de simulaciones\n# gg3 <- plot del maspalomas\n\ncairo_ps(\"FigIATE.eps\", width = 7, height = 4.3)\ngrid.arrange(gg3, gg, ncol = 2)\ndev.off()\n\n\n\n\n",
    "created" : 1509017984353.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1577468102",
    "id" : "6AC8F1C4",
    "lastKnownWriteTime" : 1489712571,
    "last_content_update" : 1489712571,
    "path" : "C:/Users/arama/Dropbox/160305 Tripadvisor/170306network_map.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}